<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daily Infection Prevention Survey-Readiness Update Report</title>
    <style>
      @page {
        size: Letter;
        margin: 0.5in;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: Arial, Helvetica, sans-serif;
        color: #111;
        background: #fff;
        font-size: 11pt;
        line-height: 1.35;
      }

      .report {
        width: 100%;
        max-width: 7.5in;
        margin: 0 auto;
      }

      .header {
        border: 1.5px solid #111;
        padding: 10px;
        margin-bottom: 10px;
      }

      .header-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 6px 24px;
        margin-bottom: 10px;
      }

      .title {
        text-align: center;
        font-size: 14pt;
        font-weight: 700;
        letter-spacing: 0.3px;
        margin: 8px 0 6px;
        text-transform: uppercase;
      }

      .instruction {
        text-align: center;
        font-size: 10pt;
        margin: 0;
      }

      .section {
        margin: 10px 0;
        page-break-inside: avoid;
      }

      h2 {
        margin: 0;
        padding: 4px 0;
        font-size: 12pt;
        font-weight: 700;
        border-bottom: 1px solid #111;
      }

      .preface {
        font-size: 9.5pt;
        color: #333;
        margin: 5px 0 8px;
      }

      .subsection {
        margin-top: 8px;
        padding-top: 6px;
        border-top: 1px solid #777;
        page-break-inside: avoid;
      }

      .subsection h3 {
        margin: 0 0 5px;
        font-size: 10.5pt;
        font-weight: 700;
      }

      .item {
        margin: 2px 0;
      }

      .placeholder {
        font-weight: 700;
      }

      .line {
        border-bottom: 1px solid #444;
        height: 20px;
        margin: 3px 0 4px;
      }

      .line.tall {
        height: 26px;
      }

      .line-block {
        margin: 6px 0;
      }

      hr {
        border: none;
        border-top: 1px solid #777;
        margin: 8px 0;
      }

      .signature-row {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 10px;
        align-items: end;
        margin-top: 10px;
      }

      .page-break {
        page-break-before: always;
        break-before: page;
      }

      .no-print-controls {
        border: 1px solid #777;
        padding: 10px;
        margin-bottom: 10px;
      }

      .control-grid {
        display: grid;
        grid-template-columns: repeat(4, minmax(0, 1fr));
        gap: 8px;
      }

      .control-grid label {
        display: block;
        font-size: 9pt;
        margin-bottom: 2px;
      }

      .control-grid input,
      .control-grid select,
      .control-grid button {
        width: 100%;
        border: 1px solid #666;
        padding: 5px 7px;
        font-size: 10pt;
      }

      .auto-note {
        font-size: 9pt;
        color: #333;
        margin: 5px 0 0;
      }

      .auto-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 6px;
        font-size: 9.5pt;
      }

      .auto-table th,
      .auto-table td {
        border: 1px solid #666;
        padding: 4px 6px;
        vertical-align: top;
      }

      @media screen {
        body {
          padding: 12px;
        }
        .report {
          border: 1px solid #b5b5b5;
          padding: 14px;
        }
      }

      @media print {
        body {
          padding: 0;
        }

        .no-print-controls {
          display: none;
        }

        .report {
          border: none;
          padding: 0;
        }
      }
    </style>
  </head>
  <body>
    <main class="report">
      <section class="no-print-controls">
        <div class="control-grid">
          <div>
            <label for="reportDate">Report date</label>
            <input id="reportDate" type="date" />
          </div>
          <div>
            <label for="unitSelect">Unit</label>
            <select id="unitSelect"></select>
          </div>
          <div>
            <label for="facilityInput">Facility Name</label>
            <input
              id="facilityInput"
              type="text"
              placeholder="[ENTER FACILITY NAME]"
            />
          </div>
          <div>
            <label>&nbsp;</label>
            <button id="autofillButton" type="button">
              Auto-fill from Active Records
            </button>
          </div>
        </div>
        <p class="auto-note">
          Auto-fill reads from <strong>UNIFIED_DB_V1</strong> (ip_cases, abx,
          vax). If unavailable, placeholders remain for manual completion.
        </p>
      </section>

      <header class="header">
        <div class="header-grid">
          <div>
            <strong>Facility Name:</strong>
            <span class="placeholder" id="facilityName"
              >[ENTER FACILITY NAME]</span
            >
          </div>
          <div>
            <strong>Unit (if applicable):</strong>
            <span class="placeholder" id="unitName">[ENTER UNIT]</span>
          </div>
          <div>
            <strong>Date of Report:</strong>
            <span class="placeholder" id="dateOfReport">[ENTER DATE]</span>
          </div>
          <div>
            <strong>Prepared By:</strong>
            <span class="placeholder">[ENTER NAME/TITLE]</span>
          </div>
          <div>
            <strong>Reviewed By:</strong>
            <span class="placeholder">[ENTER SUPERVISOR NAME/TITLE]</span>
          </div>
        </div>
        <div class="title">
          Daily Infection Prevention Survey-Readiness Update Report
        </div>
        <p class="instruction">
          This form is completed DAILY to document infection surveillance,
          actions taken, and follow-up at both the facility and unit level.
        </p>
      </header>

      <section class="section">
        <h2>
          SECTION A — FACILITY-WIDE IP PROGRAM UPDATE (For IP Nurse Binder)
        </h2>
        <p class="preface">
          Section A documents facility-wide infection prevention and control
          activity for the day, using standardized surveillance criteria and
          evidence-based practice.
        </p>

        <div class="subsection">
          <h3>1. Surveillance Summary (Facility-Wide)</h3>
          <div class="item">
            • Surveillance criteria used today (e.g., McGeer/NHSN):
            <span class="placeholder">[DESCRIBE]</span>
          </div>
          <div class="item">
            • New infections identified today:
            <span class="placeholder">[NUMBER / NONE]</span>
          </div>
          <div class="item">
            • Primary infection syndromes today:
            <span class="placeholder">[LIST OR NONE]</span>
          </div>
          <div class="item">
            • Residents with new or ongoing infections (Name/Room/Diagnosis):
            <span class="placeholder">[LIST OR NONE]</span>
          </div>
          <div class="item">
            • Source of detection: <span class="placeholder">[DESCRIBE]</span>
          </div>
          <div class="item">
            • Actions taken:
            <span class="placeholder">[DESCRIBE ACTION TAKEN]</span>
          </div>
          <div class="item">
            • Entered into surveillance tracking log / software:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="line-block">
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
          </div>
        </div>

        <div class="subsection">
          <h3>
            2. Isolation, Enhanced Barrier Precautions (EBP) &amp;
            Transmission-Based Precautions
          </h3>
          <div class="item">
            • Auto-populated active precautions snapshot:
            <span class="placeholder" id="autoPrecautionsSummary"
              >[N/A IF NONE]</span
            >
          </div>
          <table class="auto-table" id="precautionsTable">
            <thead>
              <tr>
                <th>Resident</th>
                <th>Room</th>
                <th>Unit</th>
                <th>Type</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="5">[SEE ATTACHED LOG / N/A]</td>
              </tr>
            </tbody>
          </table>
          <div class="item">
            • New transmission-based precautions initiated today:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • Resident name(s)/room(s) and type:
            <span class="placeholder">[LIST OR NONE]</span>
          </div>
          <div class="item">
            • Precautions discontinued today:
            <span class="placeholder">[LIST OR NONE]</span>
          </div>
          <div class="item">
            • Residents on EBP today:
            <span class="placeholder">[LIST OR NONE]</span>
          </div>
          <div class="item">
            • EBP implementation verified:
            <span class="placeholder">[YES/NO / DESCRIBE]</span>
          </div>
          <div class="item">
            • Isolation / EBP signage and door instructions correct:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • PPE supply status for isolation/EBP rooms:
            <span class="placeholder">[ADEQUATE / LOW / CRITICAL]</span>
          </div>
          <div class="item">
            • Any deviation from policy noted:
            <span class="placeholder">[DESCRIBE OR NONE]</span>
          </div>
        </div>

        <div class="subsection">
          <h3>3. Outbreak &amp; Cluster Monitoring</h3>
          <div class="item">
            • Suspected outbreak activity today:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • Units involved and syndrome:
            <span class="placeholder">[DESCRIBE OR NONE]</span>
          </div>
          <div class="item">
            • Number of residents in current cluster:
            <span class="placeholder">[NUMBER / N/A]</span>
          </div>
          <div class="item">
            • Testing performed today:
            <span class="placeholder">[DESCRIBE OR NONE]</span>
          </div>
          <div class="item">
            • Public health or DOH notification required today:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • If YES, date/time notified and contact:
            <span class="placeholder">[DESCRIBE]</span>
          </div>
          <div class="item">
            • Interim control measures implemented:
            <span class="placeholder">[DESCRIBE]</span>
          </div>
          <div class="line-block">
            <div class="line"></div>
            <div class="line"></div>
          </div>
        </div>

        <div class="subsection">
          <h3>4. Antibiotic Stewardship Activity</h3>
          <div class="item">
            • Auto-populated new antibiotic starts (selected date):
            <span class="placeholder" id="autoAbxStarts">[NUMBER / NONE]</span>
          </div>
          <table class="auto-table" id="abxTable">
            <thead>
              <tr>
                <th>Resident</th>
                <th>Unit</th>
                <th>Medication</th>
                <th>Indication</th>
                <th>Start Date</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="5">[SEE ATTACHED LOG / N/A]</td>
              </tr>
            </tbody>
          </table>
          <div class="item">
            • New antibiotic starts today:
            <span class="placeholder">[NUMBER / NONE]</span>
          </div>
          <div class="item">
            • Infection indication(s) documented:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • Indications reviewed with evidence-based criteria:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • Cultures obtained when indicated:
            <span class="placeholder">[YES/NO / N/A]</span>
          </div>
          <div class="item">
            • 48–72 hour antibiotic timeout review completed:
            <span class="placeholder">[YES/NO / N/A]</span>
          </div>
          <div class="item">
            • Opportunities identified:
            <span class="placeholder">[DESCRIBE OR NONE]</span>
          </div>
          <div class="item">
            • Stewardship concerns:
            <span class="placeholder">[DESCRIBE OR NONE]</span>
          </div>
          <div class="item">
            • Provider/pharmacist notified:
            <span class="placeholder">[YES/NO / N/A]</span>
          </div>
        </div>

        <div class="subsection">
          <h3>5. Immunization Program Activity</h3>
          <div class="item">
            • Auto-populated vaccines administered today:
            <span class="placeholder" id="autoVaccineCount"
              >[DESCRIBE OR NONE]</span
            >
          </div>
          <table class="auto-table" id="vaccineTable">
            <thead>
              <tr>
                <th>Resident</th>
                <th>Unit</th>
                <th>Vaccine</th>
                <th>Status</th>
                <th>Date Given</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="5">[SEE ATTACHED LOG / N/A]</td>
              </tr>
            </tbody>
          </table>
          <div class="item">
            • Vaccines administered today:
            <span class="placeholder">[DESCRIBE OR NONE]</span>
          </div>
          <div class="item">
            • New admissions/readmissions screened for vaccine status:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • Refusals/declinations today:
            <span class="placeholder">[DESCRIBE OR NONE]</span>
          </div>
          <div class="item">
            • Resident/family education on vaccination provided:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • Any barriers or supply issues:
            <span class="placeholder">[DESCRIBE OR NONE]</span>
          </div>
        </div>

        <div class="subsection">
          <h3>6. Staff Illness, Exposure &amp; Work Restrictions</h3>
          <div class="item">
            • Staff illness reported today:
            <span class="placeholder">[DESCRIBE OR NONE]</span>
          </div>
          <div class="item">
            • Work restrictions/exclusions implemented:
            <span class="placeholder">[YES/NO / DESCRIBE]</span>
          </div>
          <div class="item">
            • Exposure incidents:
            <span class="placeholder">[DESCRIBE OR NONE]</span>
          </div>
          <div class="item">
            • Occupational health notified as required:
            <span class="placeholder">[YES/NO / N/A]</span>
          </div>
          <div class="item">
            • Follow-up actions planned:
            <span class="placeholder">[DESCRIBE]</span>
          </div>
        </div>

        <div class="subsection">
          <h3>7. Environmental Infection Control (Facility-Level)</h3>
          <div class="item">
            • Environmental/cleaning concerns identified:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • Location(s) and issues:
            <span class="placeholder">[DESCRIBE]</span>
          </div>
          <div class="item">
            • High-risk areas rounded today:
            <span class="placeholder">[LIST OR N/A]</span>
          </div>
          <div class="item">
            • Terminal/enhanced cleaning performed:
            <span class="placeholder">[YES/NO / DESCRIBE]</span>
          </div>
          <div class="item">
            • Disinfectant supply status facility-wide:
            <span class="placeholder">[ADEQUATE / LOW / CRITICAL]</span>
          </div>
          <div class="item">
            • Linen/waste/sharps concerns noted:
            <span class="placeholder">[DESCRIBE OR NONE]</span>
          </div>
        </div>

        <div class="subsection">
          <h3>8. Education, Observation &amp; Compliance Activities</h3>
          <div class="item">
            • Infection prevention education provided today:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • Topic(s): <span class="placeholder">[DESCRIBE OR N/A]</span>
          </div>
          <div class="item">
            • Target audience:
            <span class="placeholder">[DESCRIBE OR N/A]</span>
          </div>
          <div class="item">
            • Hand hygiene or PPE observations performed:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • Direct observations:
            <span class="placeholder">[NUMBER COMPLETED]</span>
          </div>
          <div class="item">
            • Noncompliance episodes noted:
            <span class="placeholder">[DESCRIBE OR NONE]</span>
          </div>
          <div class="item">
            • Corrective actions taken:
            <span class="placeholder">[DESCRIBE OR NONE]</span>
          </div>
          <div class="item">
            • Staff/department requiring focused follow-up:
            <span class="placeholder">[LIST OR NONE]</span>
          </div>
        </div>

        <div class="subsection">
          <h3>9. Communication &amp; Reporting (Facility-Level)</h3>
          <div class="item">
            • Providers notified of infection-related changes today:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • Key provider notifications:
            <span class="placeholder">[DESCRIBE OR N/A]</span>
          </div>
          <div class="item">
            • Resident/family notifications:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • Resident/family notification summary:
            <span class="placeholder">[DESCRIBE OR N/A]</span>
          </div>
          <div class="item">
            • Administrative/leadership updates provided:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • NHSN/mandated reporting performed:
            <span class="placeholder">[YES/NO / N/A]</span>
          </div>
          <div class="item">
            • Module(s) updated:
            <span class="placeholder">[DESCRIBE OR N/A]</span>
          </div>
        </div>

        <div class="subsection">
          <h3>10. Follow-Up Items &amp; QAPI Linkage</h3>
          <div class="item">
            • Issues requiring follow-up:
            <span class="placeholder">[DESCRIBE OR NONE]</span>
          </div>
          <div class="item">
            • Items referred to QAPI/performance improvement project:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • If YES, description and responsible person/department:
            <span class="placeholder">[DESCRIBE]</span>
          </div>
          <div class="item">
            • Target date for follow-up completion:
            <span class="placeholder">[ENTER DATE]</span>
          </div>
          <div class="line-block">
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
          </div>
        </div>
      </section>

      <div class="page-break"></div>

      <section class="section">
        <h2>
          SECTION B — UNIT-LEVEL INFECTION PREVENTION UPDATE (For Unit Binder)
        </h2>
        <p class="preface">
          Section B is completed at the unit level to document point-of-care
          infection prevention status and actions for this shift/day.
        </p>

        <div class="subsection">
          <h3>1. Current Isolation, EBP &amp; Signage on Unit</h3>
          <div class="item">
            • Total residents on transmission-based precautions:
            <span class="placeholder">[NUMBER]</span>
          </div>
          <div class="item">
            • Residents on Enhanced Barrier Precautions (EBP):
            <span class="placeholder">[LIST OR NONE]</span>
          </div>
          <div class="item">
            • New precautions/EBP initiated today:
            <span class="placeholder">[LIST OR NONE]</span>
          </div>
          <div class="item">
            • Precautions/EBP discontinued today:
            <span class="placeholder">[LIST OR NONE]</span>
          </div>
          <div class="item">
            • Signage at room entrances correct and visible:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • PPE and supplies available at point of care:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • Any observed deviation from protocol:
            <span class="placeholder">[DESCRIBE OR NONE]</span>
          </div>
        </div>

        <div class="subsection">
          <h3>2. Symptom Surveillance on Unit</h3>
          <div class="item">
            • New fever cases today:
            <span class="placeholder">[NUMBER / NONE]</span>
          </div>
          <div class="item">
            • New respiratory symptoms today:
            <span class="placeholder">[NUMBER / NONE]</span>
          </div>
          <div class="item">
            • New GI symptoms today:
            <span class="placeholder">[NUMBER / NONE]</span>
          </div>
          <div class="item">
            • Skin/wound infection concerns raised today:
            <span class="placeholder">[NUMBER / NONE]</span>
          </div>
          <div class="item">
            • Any suspected cluster on this unit:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • Provider/IP notified for concerning symptoms or cluster:
            <span class="placeholder">[YES/NO / DESCRIBE]</span>
          </div>
        </div>

        <div class="subsection">
          <h3>3. Device &amp; Wound Monitoring</h3>
          <div class="item">
            • Residents with indwelling urinary catheters:
            <span class="placeholder">[NUMBER]</span>
          </div>
          <div class="item">
            • Catheter issues or potential CAUTI concerns:
            <span class="placeholder">[YES/NO / DESCRIBE]</span>
          </div>
          <div class="item">
            • Residents with central lines/vascular devices:
            <span class="placeholder">[NUMBER]</span>
          </div>
          <div class="item">
            • Line care bundle concerns:
            <span class="placeholder">[DESCRIBE OR NONE]</span>
          </div>
          <div class="item">
            • Residents with feeding tubes/other invasive devices:
            <span class="placeholder">[NUMBER]</span>
          </div>
          <div class="item">
            • Device-related issues or infection concerns:
            <span class="placeholder">[DESCRIBE OR NONE]</span>
          </div>
          <div class="item">
            • Wounds with signs/symptoms of infection:
            <span class="placeholder">[YES/NO / DESCRIBE]</span>
          </div>
          <div class="item">
            • Device/wound concerns communicated to provider/IP:
            <span class="placeholder">[YES/NO / N/A]</span>
          </div>
        </div>

        <div class="subsection">
          <h3>4. Equipment &amp; Environmental Cleaning (Unit-Level)</h3>
          <div class="item">
            • Shared equipment cleaned between residents per protocol:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • Glucometer cleaning/disinfection verified:
            <span class="placeholder">[YES/NO / N/A]</span>
          </div>
          <div class="item">
            • Isolation equipment handled and cleaned correctly:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • High-touch common surfaces appear clean and uncluttered:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • Environmental/cleaning concern noted:
            <span class="placeholder">[DESCRIBE OR NONE]</span>
          </div>
          <div class="item">
            • Environmental services notified for follow-up:
            <span class="placeholder">[YES/NO / N/A]</span>
          </div>
        </div>

        <div class="subsection">
          <h3>5. Hand Hygiene &amp; PPE Compliance (Unit Snapshot)</h3>
          <div class="item">
            • Overall hand hygiene compliance observed today:
            <span class="placeholder">[ADEQUATE / NEEDS IMPROVEMENT]</span>
          </div>
          <div class="item">
            • Approximate hand hygiene opportunities observed:
            <span class="placeholder">[ENTER NUMBER / N/A]</span>
          </div>
          <div class="item">
            • Approximate missed hand hygiene opportunities:
            <span class="placeholder">[ENTER NUMBER / N/A]</span>
          </div>
          <div class="item">
            • PPE use observed during resident care:
            <span class="placeholder">[ADEQUATE / NEEDS IMPROVEMENT]</span>
          </div>
          <div class="item">
            • Immediate feedback/coaching provided:
            <span class="placeholder">[YES/NO / DESCRIBE]</span>
          </div>
        </div>

        <div class="subsection">
          <h3>6. Staff Education / Just-in-Time Coaching on Unit</h3>
          <div class="item">
            • Just-in-time teaching provided today:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • Topics covered: <span class="placeholder">[DESCRIBE OR N/A]</span>
          </div>
          <div class="item">
            • Staff groups reached:
            <span class="placeholder">[DESCRIBE OR N/A]</span>
          </div>
          <div class="item">
            • Staff requiring follow-up education:
            <span class="placeholder">[LIST OR NONE]</span>
          </div>
          <div class="item">
            • Education materials used/provided:
            <span class="placeholder">[DESCRIBE OR N/A]</span>
          </div>
        </div>

        <div class="subsection">
          <h3>7. Reporting, Escalation &amp; Unit Leadership Involvement</h3>
          <div class="item">
            • IP Nurse notified of unit concerns today:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • What was reported:
            <span class="placeholder">[DESCRIBE OR N/A]</span>
          </div>
          <div class="item">
            • Provider notifications made:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • Incident/occurrence reports filed:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • Discussed during unit huddle/shift report:
            <span class="placeholder">[YES/NO]</span>
          </div>
          <div class="item">
            • Issues requiring escalation to leadership:
            <span class="placeholder">[DESCRIBE OR NONE]</span>
          </div>
        </div>
      </section>

      <section class="section">
        <h2>SECTION C — SIGNATURES &amp; ADDITIONAL NOTES</h2>
        <div class="signature-row">
          <div>
            <strong>Prepared by (Unit or Facility Representative):</strong>
            __________________________________________
          </div>
          <div><strong>Date:</strong> __________</div>
        </div>
        <div class="signature-row">
          <div>
            <strong>Reviewed by (IP Nurse / DON / Designee):</strong>
            __________________________________________
          </div>
          <div><strong>Date:</strong> __________</div>
        </div>
        <hr />
        <div><strong>Additional Notes / Narrative Summary:</strong></div>
        <div class="line-block">
          <div class="line tall"></div>
          <div class="line tall"></div>
          <div class="line tall"></div>
          <div class="line tall"></div>
          <div class="line tall"></div>
          <div class="line tall"></div>
        </div>
        <div class="item">
          Surveyor questions / family concerns / emerging trends /
          clarifications:
          <span class="placeholder">[SEE ATTACHED LOG / N/A]</span>
        </div>
      </section>
    </main>

    <script>
      function safeParse(raw, fallback) {
        try {
          return JSON.parse(raw);
        } catch (_err) {
          return fallback;
        }
      }

      function toISODate(value) {
        if (!value) return null;
        if (typeof value === "string" && /^\d{4}-\d{2}-\d{2}$/.test(value))
          return value;
        const date = new Date(value);
        if (Number.isNaN(date.getTime())) return null;
        return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, "0")}-${String(date.getDate()).padStart(2, "0")}`;
      }

      function pick(record, keys) {
        for (const key of keys) {
          if (
            record &&
            record[key] !== undefined &&
            record[key] !== null &&
            String(record[key]).trim() !== ""
          ) {
            return record[key];
          }
        }
        return null;
      }

      function inferStartDate(record) {
        return toISODate(
          pick(record, [
            "onsetDate",
            "precautionStartDate",
            "initiationDate",
            "startDate",
          ]),
        );
      }

      function inferEndDate(record) {
        return toISODate(
          pick(record, [
            "resolutionDate",
            "precautionEndDate",
            "dischargeDate",
            "endDate",
          ]),
        );
      }

      function getUnit(record) {
        return String(
          pick(record, ["unit", "unitId", "locationUnit"]) || "",
        ).trim();
      }

      function unitMatch(record, selectedUnit) {
        if (selectedUnit === "facility") return true;
        return getUnit(record) === selectedUnit;
      }

      function isActiveOnDate(record, reportDate) {
        const startDate = inferStartDate(record);
        const endDate = inferEndDate(record);
        if (!startDate || startDate > reportDate) return false;
        if (!endDate) return true;
        return endDate >= reportDate;
      }

      function writeRows(tableId, rows, fallbackColspan) {
        const body = document.querySelector(`#${tableId} tbody`);
        if (!body) return;
        if (!rows.length) {
          body.innerHTML = `<tr><td colspan="${fallbackColspan}">[SEE ATTACHED LOG / N/A]</td></tr>`;
          return;
        }
        body.innerHTML = rows
          .map(
            (cells) => `<tr>${cells.map((c) => `<td>${c}</td>`).join("")}</tr>`,
          )
          .join("");
      }

      function collectUnits(db) {
        const units = new Set(["facility"]);
        [
          db.records?.ip_cases || [],
          db.records?.abx || [],
          db.records?.vax || [],
        ].forEach((list) => {
          list.forEach((record) => {
            const unit = getUnit(record);
            if (unit) units.add(unit);
          });
        });
        return Array.from(units);
      }

      function normalize(db) {
        return {
          records: {
            ip_cases: Array.isArray(db?.records?.ip_cases)
              ? db.records.ip_cases
              : [],
            abx: Array.isArray(db?.records?.abx) ? db.records.abx : [],
            vax: Array.isArray(db?.records?.vax) ? db.records.vax : [],
          },
        };
      }

      function applyAutoFill() {
        const db = normalize(
          safeParse(localStorage.getItem("UNIFIED_DB_V1"), {}),
        );
        const reportDate =
          document.getElementById("reportDate").value || toISODate(new Date());
        const selectedUnit =
          document.getElementById("unitSelect").value || "facility";
        const facilityValue = document
          .getElementById("facilityInput")
          .value.trim();

        document.getElementById("facilityName").textContent =
          facilityValue || "[ENTER FACILITY NAME]";
        document.getElementById("unitName").textContent =
          selectedUnit === "facility" ? "Facility (All Units)" : selectedUnit;
        document.getElementById("dateOfReport").textContent =
          reportDate || "[ENTER DATE]";

        const activePrecautions = db.records.ip_cases.filter(
          (record) =>
            unitMatch(record, selectedUnit) &&
            isActiveOnDate(record, reportDate),
        );
        const newAbx = db.records.abx.filter(
          (record) =>
            unitMatch(record, selectedUnit) &&
            toISODate(pick(record, ["startDate", "orderDate", "createdAt"])) ===
              reportDate,
        );
        const vaxGiven = db.records.vax.filter((record) => {
          const status = String(pick(record, ["status"]) || "").toLowerCase();
          return (
            unitMatch(record, selectedUnit) &&
            status === "given" &&
            toISODate(
              pick(record, ["dateGiven", "givenDate", "administrationDate"]),
            ) === reportDate
          );
        });

        document.getElementById("autoPrecautionsSummary").textContent =
          activePrecautions.length
            ? `${activePrecautions.length} active case(s)`
            : "[N/A IF NONE]";
        document.getElementById("autoAbxStarts").textContent = newAbx.length
          ? String(newAbx.length)
          : "[NUMBER / NONE]";
        document.getElementById("autoVaccineCount").textContent =
          vaxGiven.length
            ? `${vaxGiven.length} dose(s) documented`
            : "[DESCRIBE OR NONE]";

        writeRows(
          "precautionsTable",
          activePrecautions.map((record) => [
            pick(record, ["residentName", "name", "mrn"]) || "[ENTER NAME]",
            pick(record, ["room", "roomNumber", "location"]) || "[N/A IF NONE]",
            getUnit(record) || "[N/A IF NONE]",
            pick(record, ["precautionType", "isolationType", "protocol"]) ||
              "[CHECK IF APPLICABLE]",
            inferEndDate(record) ? "Closed" : "Active",
          ]),
          5,
        );

        writeRows(
          "abxTable",
          newAbx.map((record) => [
            pick(record, ["residentName", "name", "mrn"]) || "[ENTER NAME]",
            getUnit(record) || "[N/A IF NONE]",
            pick(record, ["antibiotic", "medication", "drug"]) ||
              "[DESCRIBE ACTION TAKEN]",
            pick(record, ["indication", "reason", "diagnosis"]) ||
              "[N/A IF NONE]",
            toISODate(pick(record, ["startDate", "orderDate", "createdAt"])) ||
              "[N/A IF NONE]",
          ]),
          5,
        );

        writeRows(
          "vaccineTable",
          vaxGiven.map((record) => [
            pick(record, ["residentName", "name", "mrn"]) || "[ENTER NAME]",
            getUnit(record) || "[N/A IF NONE]",
            pick(record, ["vaccineType", "vaccine", "type"]) || "[N/A IF NONE]",
            pick(record, ["status"]) || "given",
            toISODate(
              pick(record, ["dateGiven", "givenDate", "administrationDate"]),
            ) || "[N/A IF NONE]",
          ]),
          5,
        );
      }

      (function initAutoFill() {
        const unitSelect = document.getElementById("unitSelect");
        const reportDate = document.getElementById("reportDate");
        const db = normalize(
          safeParse(localStorage.getItem("UNIFIED_DB_V1"), {}),
        );
        const units = collectUnits(db);
        unitSelect.innerHTML = units
          .map(
            (unit) =>
              `<option value="${unit}">${unit === "facility" ? "Facility (All Units)" : unit}</option>`,
          )
          .join("");
        reportDate.value = toISODate(new Date());
        document
          .getElementById("autofillButton")
          .addEventListener("click", applyAutoFill);
        applyAutoFill();
      })();
    </script>
  </body>
</html>
